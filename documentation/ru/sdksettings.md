Описание настроек  необходимых для работы TotalAPI SDK
================================================================
Все конфигурационные параметры SDK задаются в файле `app.exe.config` пользовательского приложения использующего SDK. 

Запуск и подключение
---------------------------------------------------------------
Для инициализации SDK и подключения к сервисам TotalApi необходимо указать адрес подключения к [серверу биллинга]() TotalApi. 
В файле app.config:  

    <appSettings>
    	<add key="serverProtocol" value="https" />
    	<add key="serverHost" value="svc.totalapi.io:4444" />
    </appSettings>
В данном примере указано, что подключение будет установлено по  по адресу *https://svc.totalapi.io:4444* 

При старте приложения следует вызвать метод инициализации клиентского SDK:
    
    TotalApiBootstrapper.AppModulesSearchPattern = "myApp.*.dll";
    TotalApiBootstrapper.Create(".");    // Параметром вызова является каталог, в котором находятся файлы SDK. 
                                         // (Или список каталогов, разделённых точкой с запятой).

SDK для своей работы использует платформу [MEF](http://bit.do/bE73V) и данный вызов производит компоновку композиции.** Хорошая новость:** теперь вы можете использовать [MEF](http://bit.do/bE73V) в своём приложении для своих классов без дополнительного конфигурирования, если названия сборок, содержащих экспортируемые классы, соответствуют маске, установленной в свойстве AppModulesSearchPattern. Если данный параметр не установлен – никакие другие сборки не будут автоматически подключены. (Сборка из которой была произведена инициализация [MEF](http://bit.do/bE73V) будет подключена к композиции в любом случае). 
> Не устанавливайте маску *.dll, т.к. в этом случае будет сделана попытка добавить в композицию все сборки, находящиеся в указанных папках, (в том числе и системные), что может привести к очень долгому старту программы.
> Не меняйте названия файлов SDK, т.к. они включаются в композицию по маске  TotalApi.*.dll

Аутентификация на сервисе TotalAPI
--------------------------------------------------------------------
Для более полного понимания вариантов авторизации ознакомтесь с [подробным описанием системы аутентификации TotalAPI]()
В простейшем случае разработчик должен только указать значения  ключей (ApiKey или AppKey). 
Указать значения ключей аутентификации можно либо через конфигурационный файл app.config (только для ApiKey / AppKey) либо явно в коде приложения.
* Аутентификация по ApiKey в конфигурационном файле:

    	<appSettings>
		    <add key="ApiKey" value="myApiKey" />
    	</appSettings>
    
*  Аутентификация по AppKey в коде программы:

		TotalApiAuth.AppKey = "myAppKey";
		TotalApiAuth.UserLogin = "user1";	
		TotalApiAuth.UserPassword = "pass";

Другие настройки TotalAPI SDK
--------------------------------------------------------------------
### Общие параметры приложения:	   

| Параметр |Значение|
|------------------|---------------|
|isDebugMode 		| Признак того, что приложение запущено в отладочном режиме. Применимо только для Web-приложения. true - Debug конфигураця, false - не Debug конфигурация|
|totalapi.log		| Настройки протоколирования. См. ниже ()|
|modulesFolders	| Перечень каталогов, разделённых точкой с запятой, откуда следует загружать сборки программных модулей. Позволяет использовать относительную адресацию, относительно исполнимого файла приложения. Поддерживается рекурсивная загрузка из подкаталогов указанных каталогов. Модули из каталога приложения будут загружены в любом случае. Загружены будут только модули с именем вида TotalApi.*.dll. По умолчанию - Modules|
|logThreadEnabled	| Управление очередью логирования. true - все сообщения логгера попадают в очередь, которая обрабатывается одним отдельным потоком. false - без очереди (может существенно замедлить работу программы). По умолчанию - true|

### Параметры клиентского приложения:

| Параметр |Значение|
|---------------|---------------|
| serverHost	|Адрес хоста и (опционально) порт подключения к сервису биллинга. Если порт не указан - используется порт по умолчанию в зависимости от протокола. По умолчанию - localhost |
| serverProtocol|Протокол хостинга сервисов (http, https - по умолчанию). Для возможности подключения к сервисам по HTTP-протоколу, необходимо зарегистрировать и замапить на указанный порт сертификат. |
| serverEndpoint|Шаблон адреса точки подключения к [сервису биллинга](). Шаблоны  в фигурных скобках будут заменены соответствующими значениями при построении адреса. Если макроопределение {ApiType} отсутствует - сервис не будет хостить WebApi сервисы. Если макроопределения {ServiceProtocol} и {ServiceContract} отсутствуют в шаблоне - они будут автоматически добавлены в начало и конец шаблона соответственно. По умолчанию* {ServiceProtocol}://{ServiceHost}/{ApplicationName}/api/{ApiVersion}/{ApiType}/{ServiceContract}*||
| apiKey		|Значение ApiKey клиента. Если не указано - можно установить программно свойство TotalApiAuth.ApiKey ДО инициализации MefBootstrapper'a. |
| appKey		|Значение AppKey клиента. Если не указано - можно установить программно свойство TotalApiAuth.AppKey ДО инициализации MefBootstrapper'a. если установлено одновременно оба значения apiKey и appKey - значение appKey игнорируется.|

### Параметры для управления протоколированием приложения:
Данные настройки влияют на вывод информации передаваемой через интерфейс ILogger. По умолчанию приложение сконфигурировано так,что в качестве обработчика протоколирования уже подключен класс FileLogger, который управляется этими командами.

Простой способ - использовать следующие команды раздела `<appSettings>`:

| Параметр |Значение|
|---------------|---------------|
|totalapi.log.file 		| Имя файла протокола. Если полный путь не задан - он расширяется относительно каталога запуска программы. Если указано имя CON - вывод будет вестись не в файл, а в консоль. Поддерживаются макроподстановки, используемые в методе FileSystemExtension.ExpandPath.|
|totalapi.log.level 	        | Битовая маска, задающая уровень протоколирования: x01 - информационные сообщения, x02 - предупреждения, x04 - ошибки. По умолчанию x07|
|totalapi.log.append 	| Управление созданием файла лога при старте программы. true - создавать файл протокола заново при старте программы, false - дописывать в существующий. По умолчанию false|
|totalapi.log.console 	| Управление выводом протокола на консоль. true - дублировать вывод лога на консоль, false - логировать только в файл. По умолчанию - fzlse. В DEBUG сборке значение этого параметра по умолчанию равно true.|

Расширенный способ - позволяет задавать несколько файлов протокола. Вначале в начало файла app.config требуется добавить описание конфигурационной секции totalapi.log:

	  <configSections>
		  <section name="totalapi.log" type="TotalApi.Core.Api.FileLoggerConfiguration, TotalApi.Core" />
	  </configSections>  

Затем в разделе files конфигурационной секции totalapi.log можно конфигурировать файлы протокола:

	  <totalapi.log>
              <files>
                  <add file="con" level="7" />
                  <add file="c:\temp\log.txt" console="true" append="true" />
             </files>
      </totalapi.log>

**ВАЖНО!**
> Для Web-приложения НЕЛЬЗЯ указывать файл протокола в каталоге или подкаталоге исполняемых файлов приложения.  В этом случае Web-приложение будет постоянно перезагружаться при попытке записи в протокол.